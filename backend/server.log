yarn run v1.22.22
$ ts-node-dev --respawn --transpile-only src/server/index-minimal.ts
[INFO] 16:59:47 ts-node-dev ver. 2.0.0 (using ts-node ver. 10.9.2, typescript ver. 5.8.3)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='campaigns';
Executing (default): PRAGMA INDEX_LIST(`campaigns`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_prizes';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_prizes`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_templates';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_templates`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_nodes';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_nodes`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_edges';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_edges`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_messages';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_messages`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_select_options';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_select_options`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_cards';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_cards`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_card_buttons';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_card_buttons`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_conversations';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_conversations`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_lottery';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_lottery`)
„Éá„Éº„Çø„Éô„Éº„Çπ„ÅÆÂêåÊúü„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ
[32minfo[39m: üöÄ „Çµ„Éº„Éê„Éº„ÅåËµ∑Âãï„Åó„Åæ„Åó„Åü {"service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:48"}
[32minfo[39m: üåç Áí∞Â¢É: development {"service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:48"}
[32minfo[39m: üì° „Éù„Éº„Éà: 3001 {"service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:48"}
[32minfo[39m: üîó URL: http://localhost:3001 {"service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:48"}
[32minfo[39m: ‚ù§Ô∏è  Health Check: http://localhost:3001/health {"service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:48"}
[32minfo[39m: üìä API: http://localhost:3001/api/campaigns {"service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:48"}
[32minfo[39m: Request received {"ip":"::1","method":"GET","service":"instagram-crm-backend","timestamp":"2025-07-27 16:59:59","url":"/health","userAgent":"curl/8.7.1"}
[32minfo[39m: Request completed {"duration":"4ms","method":"GET","service":"instagram-crm-backend","statusCode":200,"timestamp":"2025-07-27 16:59:59","url":"/health"}
[32minfo[39m: Request received {"ip":"::1","method":"GET","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:07","url":"/api/campaigns","userAgent":"curl/8.7.1"}
[31merror[39m: „Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü: campaign_service_1.CampaignService.getCampaigns is not a function {"body":{},"method":"GET","params":{},"query":{},"service":"instagram-crm-backend","stack":"TypeError: campaign_service_1.CampaignService.getCampaigns is not a function\n    at getCampaigns (/Users/sakamotodaigorou/private_task/chatbot/backend/src/server/api/campaigns/get_campaigns_api.ts:26:42)\n    at Layer.handle [as handle_request] (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/route.js:149:13)\n    at /Users/sakamotodaigorou/private_task/chatbot/backend/src/server/middleware/validation_middleware.ts:54:5\n    at Layer.handle [as handle_request] (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/layer.js:95:5)\n    at next (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/layer.js:95:5)\n    at /Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/index.js:284:15\n    at router.process_params (/Users/sakamotodaigorou/private_task/chatbot/node_modules/express/lib/router/index.js:346:12)","timestamp":"2025-07-27 17:00:07","url":"/api/campaigns"}
[32minfo[39m: Request completed {"duration":"3ms","method":"GET","service":"instagram-crm-backend","statusCode":500,"timestamp":"2025-07-27 17:00:07","url":"/api/campaigns"}
[32minfo[39m: Request received {"ip":"::1","method":"POST","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:10","url":"/api/campaigns","userAgent":"curl/8.7.1"}
Executing (default): INSERT INTO `campaigns` (`id`,`title`,`description`,`status`,`created`,`modified`) VALUES (NULL,$1,$2,$3,$4,$5);
[32minfo[39m: „Ç≠„É£„É≥„Éö„Éº„É≥„Åå‰ΩúÊàê„Åï„Çå„Åæ„Åó„Åü: {"id":2,"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:10","title":"„ÉÜ„Çπ„Éà„Ç≠„É£„É≥„Éö„Éº„É≥"}
[32minfo[39m: Request completed {"duration":"7ms","method":"POST","service":"instagram-crm-backend","statusCode":201,"timestamp":"2025-07-27 17:00:10","url":"/"}
[32minfo[39m: Request received {"ip":"::1","method":"GET","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:11","url":"/api/campaigns/1","userAgent":"curl/8.7.1"}
Executing (default): SELECT `Campaign`.`id`, `Campaign`.`title`, `Campaign`.`description`, `Campaign`.`status`, `Campaign`.`start_date`, `Campaign`.`end_date`, `Campaign`.`created`, `Campaign`.`modified`, `prizes`.`id` AS `prizes.id`, `prizes`.`campaign_id` AS `prizes.campaign_id`, `prizes`.`name` AS `prizes.name`, `prizes`.`description` AS `prizes.description`, `prizes`.`send_winner_count` AS `prizes.send_winner_count`, `prizes`.`winner_count` AS `prizes.winner_count`, `prizes`.`winning_rate_change_type` AS `prizes.winning_rate_change_type`, `prizes`.`winning_rate` AS `prizes.winning_rate`, `prizes`.`daily_winner_count` AS `prizes.daily_winner_count`, `prizes`.`is_daily_lottery` AS `prizes.is_daily_lottery`, `prizes`.`lottery_count_per_minute` AS `prizes.lottery_count_per_minute`, `prizes`.`lottery_count_per_minute_updated_datetime` AS `prizes.lottery_count_per_minute_updated_datetime`, `prizes`.`created` AS `prizes.created`, `prizes`.`modified` AS `prizes.modified` FROM `campaigns` AS `Campaign` LEFT OUTER JOIN `in_instantwin_prizes` AS `prizes` ON `Campaign`.`id` = `prizes`.`campaign_id` WHERE `Campaign`.`id` = 1;
[32minfo[39m: Request completed {"duration":"7ms","method":"GET","service":"instagram-crm-backend","statusCode":200,"timestamp":"2025-07-27 17:00:11","url":"/1"}
[INFO] 17:00:25 Restarting: /Users/sakamotodaigorou/private_task/chatbot/backend/src/server/services/campaign_service.ts has been modified
[32minfo[39m: SIGTERM signal received: closing HTTP server {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: HTTP server closed. {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='campaigns';
Executing (default): PRAGMA INDEX_LIST(`campaigns`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_prizes';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_prizes`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_templates';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_templates`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_nodes';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_nodes`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_edges';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_edges`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_messages';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_messages`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_select_options';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_select_options`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_cards';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_cards`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_card_buttons';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_card_buttons`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_conversations';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_conversations`)
Executing (default): SELECT name FROM sqlite_master WHERE type='table' AND name='in_instantwin_message_lottery';
Executing (default): PRAGMA INDEX_LIST(`in_instantwin_message_lottery`)
„Éá„Éº„Çø„Éô„Éº„Çπ„ÅÆÂêåÊúü„ÅåÂÆå‰∫Ü„Åó„Åæ„Åó„Åü„ÄÇ
[32minfo[39m: üöÄ „Çµ„Éº„Éê„Éº„ÅåËµ∑Âãï„Åó„Åæ„Åó„Åü {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: üåç Áí∞Â¢É: development {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: üì° „Éù„Éº„Éà: 3001 {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: üîó URL: http://localhost:3001 {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: ‚ù§Ô∏è  Health Check: http://localhost:3001/health {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: üìä API: http://localhost:3001/api/campaigns {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:25"}
[32minfo[39m: Request received {"ip":"::1","method":"GET","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:33","url":"/api/campaigns","userAgent":"curl/8.7.1"}
Executing (default): SELECT count(`Campaign`.`id`) AS `count` FROM `campaigns` AS `Campaign` LEFT OUTER JOIN `in_instantwin_prizes` AS `prizes` ON `Campaign`.`id` = `prizes`.`campaign_id`;
Executing (default): SELECT `Campaign`.*, `prizes`.`id` AS `prizes.id`, `prizes`.`name` AS `prizes.name`, `prizes`.`winning_rate` AS `prizes.winning_rate` FROM (SELECT `Campaign`.`id`, `Campaign`.`title`, `Campaign`.`description`, `Campaign`.`status`, `Campaign`.`start_date`, `Campaign`.`end_date`, `Campaign`.`created`, `Campaign`.`modified` FROM `campaigns` AS `Campaign` ORDER BY `Campaign`.`created` DESC LIMIT 0, 20) AS `Campaign` LEFT OUTER JOIN `in_instantwin_prizes` AS `prizes` ON `Campaign`.`id` = `prizes`.`campaign_id` ORDER BY `Campaign`.`created` DESC;
[32minfo[39m: Request completed {"duration":"15ms","method":"GET","service":"instagram-crm-backend","statusCode":200,"timestamp":"2025-07-27 17:00:33","url":"/"}
[32minfo[39m: Request received {"ip":"::1","method":"PUT","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:52","url":"/api/campaigns/2","userAgent":"curl/8.7.1"}
Executing (default): SELECT `id`, `title`, `description`, `status`, `start_date`, `end_date`, `created`, `modified` FROM `campaigns` AS `Campaign` WHERE `Campaign`.`id` = 2;
Executing (default): UPDATE `campaigns` SET `title`=$1,`status`=$2,`modified`=$3 WHERE `id` = $4
[32minfo[39m: „Ç≠„É£„É≥„Éö„Éº„É≥„ÅåÊõ¥Êñ∞„Åï„Çå„Åæ„Åó„Åü: {"id":2,"service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:52","title":"Êõ¥Êñ∞„Åï„Çå„Åü„Çø„Ç§„Éà„É´"}
[32minfo[39m: Request completed {"duration":"16ms","method":"PUT","service":"instagram-crm-backend","statusCode":200,"timestamp":"2025-07-27 17:00:52","url":"/2"}
[32minfo[39m: Request received {"ip":"::1","method":"GET","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:52","url":"/api/campaigns/2","userAgent":"curl/8.7.1"}
Executing (default): SELECT `Campaign`.`id`, `Campaign`.`title`, `Campaign`.`description`, `Campaign`.`status`, `Campaign`.`start_date`, `Campaign`.`end_date`, `Campaign`.`created`, `Campaign`.`modified`, `prizes`.`id` AS `prizes.id`, `prizes`.`campaign_id` AS `prizes.campaign_id`, `prizes`.`name` AS `prizes.name`, `prizes`.`description` AS `prizes.description`, `prizes`.`send_winner_count` AS `prizes.send_winner_count`, `prizes`.`winner_count` AS `prizes.winner_count`, `prizes`.`winning_rate_change_type` AS `prizes.winning_rate_change_type`, `prizes`.`winning_rate` AS `prizes.winning_rate`, `prizes`.`daily_winner_count` AS `prizes.daily_winner_count`, `prizes`.`is_daily_lottery` AS `prizes.is_daily_lottery`, `prizes`.`lottery_count_per_minute` AS `prizes.lottery_count_per_minute`, `prizes`.`lottery_count_per_minute_updated_datetime` AS `prizes.lottery_count_per_minute_updated_datetime`, `prizes`.`created` AS `prizes.created`, `prizes`.`modified` AS `prizes.modified` FROM `campaigns` AS `Campaign` LEFT OUTER JOIN `in_instantwin_prizes` AS `prizes` ON `Campaign`.`id` = `prizes`.`campaign_id` WHERE `Campaign`.`id` = 2;
[32minfo[39m: Request completed {"duration":"3ms","method":"GET","service":"instagram-crm-backend","statusCode":200,"timestamp":"2025-07-27 17:00:52","url":"/2"}
[32minfo[39m: Request received {"ip":"::1","method":"GET","service":"instagram-crm-backend","timestamp":"2025-07-27 17:00:52","url":"/api/campaigns?status=active&limit=5","userAgent":"curl/8.7.1"}
Executing (default): SELECT count(`Campaign`.`id`) AS `count` FROM `campaigns` AS `Campaign` LEFT OUTER JOIN `in_instantwin_prizes` AS `prizes` ON `Campaign`.`id` = `prizes`.`campaign_id` WHERE `Campaign`.`status` = 'active';
Executing (default): SELECT `Campaign`.*, `prizes`.`id` AS `prizes.id`, `prizes`.`name` AS `prizes.name`, `prizes`.`winning_rate` AS `prizes.winning_rate` FROM (SELECT `Campaign`.`id`, `Campaign`.`title`, `Campaign`.`description`, `Campaign`.`status`, `Campaign`.`start_date`, `Campaign`.`end_date`, `Campaign`.`created`, `Campaign`.`modified` FROM `campaigns` AS `Campaign` WHERE `Campaign`.`status` = 'active' ORDER BY `Campaign`.`created` DESC LIMIT 0, 5) AS `Campaign` LEFT OUTER JOIN `in_instantwin_prizes` AS `prizes` ON `Campaign`.`id` = `prizes`.`campaign_id` ORDER BY `Campaign`.`created` DESC;
[32minfo[39m: Request completed {"duration":"3ms","method":"GET","service":"instagram-crm-backend","statusCode":200,"timestamp":"2025-07-27 17:00:52","url":"/?status=active&limit=5"}
[32minfo[39m: SIGTERM signal received: closing HTTP server {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:01:16"}
[32minfo[39m: HTTP server closed. {"service":"instagram-crm-backend","timestamp":"2025-07-27 17:01:16"}
Done in 89.22s.
